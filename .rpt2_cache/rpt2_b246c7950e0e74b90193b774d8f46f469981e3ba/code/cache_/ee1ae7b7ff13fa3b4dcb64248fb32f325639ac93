{"code":"import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\r\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Lightbox from \"react-image-lightbox\";\r\nimport axios from \"axios\";\r\nimport { IMAGE_LIMIT } from \"constants/index\";\r\nimport \"components/ImageItem/ImageItem.scss\";\r\nimport \"react-image-lightbox/style.css\";\r\nvar _window = window.window;\r\nexport var ImageItem = function (props) {\r\n    var _a = useState([]), imageList = _a[0], setImageList = _a[1];\r\n    var _b = useState(0), photoIndex = _b[0], setPhotoIndex = _b[1];\r\n    var _c = useState(false), isOpenLightBox = _c[0], setIsOpenLightBox = _c[1];\r\n    var _d = useState([]), imageListLightBox = _d[0], setImageListLightBox = _d[1];\r\n    var nameInput = useState(\"inputFile\" + props.categoryId)[0];\r\n    var onClickUpload = function () {\r\n        if (imageList.length >= IMAGE_LIMIT) {\r\n            _window.showPropzyAlertPopupGeneral(\"\\u0110\\u00E3 \\u0111\\u1EA1t gi\\u1EDBi h\\u1EA1n \" + IMAGE_LIMIT + \" h\\u00ECnh \\u1EA3nh\");\r\n            return;\r\n        }\r\n        _window.document.getElementById(nameInput).click();\r\n    };\r\n    var onFileChange = function (e) {\r\n        var filesData = e.target.files;\r\n        var promiseUpload = [];\r\n        var lengthImageList = imageList ? imageList.length : 0;\r\n        var lengthImageRemain = IMAGE_LIMIT - lengthImageList;\r\n        var lengthFilesData = filesData.length;\r\n        var filesDataToUpload = filesData;\r\n        if (lengthFilesData > lengthImageRemain) {\r\n            filesDataToUpload = __spreadArray([], filesData, true).splice(0, lengthImageRemain);\r\n        }\r\n        ;\r\n        __spreadArray([], filesDataToUpload, true).forEach(function (itemFile) { return __awaiter(void 0, void 0, void 0, function () {\r\n            var dataPost;\r\n            return __generator(this, function (_a) {\r\n                dataPost = new FormData();\r\n                dataPost.append(\"file\", itemFile);\r\n                dataPost.append(\"type\", \"listing\");\r\n                dataPost.append(\"source\", \"dashboard\");\r\n                promiseUpload.push(axios.post(_window.baseUploadApiPublic + \"upload\", dataPost));\r\n                return [2 /*return*/];\r\n            });\r\n        }); });\r\n        _window.showPropzyLoadingBPO();\r\n        try {\r\n            // get promise all image upload\r\n            Promise.all(promiseUpload).then(function (values) {\r\n                var isErrUpload = false;\r\n                var newListImage = __spreadArray([], imageList, true);\r\n                var newListImageLightBox = __spreadArray([], imageListLightBox, true);\r\n                values.forEach(function (itemFile) {\r\n                    if (itemFile && itemFile.data.result) {\r\n                        var largeLinkArr = itemFile.data.data.link.split(\"large\");\r\n                        var originLargeLink_1 = \"\";\r\n                        largeLinkArr.forEach(function (itemLink, indexLink) {\r\n                            if (indexLink == 0) {\r\n                                originLargeLink_1 = itemLink + \"origin\";\r\n                            }\r\n                            else\r\n                                originLargeLink_1 += itemLink;\r\n                        });\r\n                        newListImage = __spreadArray(__spreadArray([], newListImage, true), [\r\n                            {\r\n                                link: originLargeLink_1,\r\n                                isPrivate: false,\r\n                                source: \"dashboard\",\r\n                                isApproved: true,\r\n                            },\r\n                        ], false);\r\n                        newListImageLightBox = __spreadArray(__spreadArray([], newListImageLightBox, true), [originLargeLink_1], false);\r\n                    }\r\n                    else {\r\n                        isErrUpload = true;\r\n                    }\r\n                    // reset cache upload image\r\n                    _window.document.getElementById(nameInput).value = \"\";\r\n                });\r\n                setImageList(newListImage);\r\n                setImageListLightBox(newListImageLightBox);\r\n                _window.hidePropzyLoadingBPO();\r\n                if (isErrUpload) {\r\n                    _window.showPropzyAlertPopupGeneral(\"Đã có lỗi trong khi upload hình. Xin vui lòng thử lại\");\r\n                }\r\n            });\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n    var removeImage = function (e, item) {\r\n        e.stopPropagation();\r\n        setImageList(imageList.filter(function (itemList) { return itemList.link != item.link; }));\r\n        setImageListLightBox(imageListLightBox.filter(function (itemListLighBox) { return itemListLighBox != item.link; }));\r\n    };\r\n    useEffect(function () {\r\n        props.onHandleChangeImage(imageList, props.categoryId);\r\n    }, [imageList]);\r\n    var renderLightBox = function (index) {\r\n        setPhotoIndex(index);\r\n        setIsOpenLightBox(true);\r\n    };\r\n    return (_jsxs(_Fragment, { children: [_jsxs(\"div\", __assign({ className: \"image-item-container\" }, { children: [_jsxs(\"div\", __assign({ className: \"block-upload\" }, { children: [_jsxs(\"div\", { children: [props.categoryName, \" \", props.requiredTextInput && _jsx(\"span\", __assign({ className: \"red\" }, { children: \"*\" }), void 0)] }, void 0), props.showPhoto && (_jsxs(\"a\", __assign({ className: \"add-images-files\", onClick: onClickUpload }, { children: [_jsx(\"i\", { className: \"fa fa-camera\", \"aria-hidden\": \"true\" }, void 0), \"Th\\u00EAm \\u1EA3nh\", _jsx(\"input\", { type: \"file\", className: \"hidden\", id: nameInput, multiple: true, name: \"files[]\", onChange: function (e) {\r\n                                            onFileChange(e);\r\n                                        } }, void 0)] }), void 0))] }), void 0), _jsx(\"div\", __assign({ className: \"block-image\" }, { children: imageList.map(function (item, index) {\r\n                            return (_jsxs(\"div\", __assign({ onClick: function () { return renderLightBox(index); }, className: \"image\" }, { children: [_jsx(\"img\", { src: item.link || \"\", alt: \"\" }, void 0), _jsx(\"span\", __assign({ onClick: function (e) { return removeImage(e, item); } }, { children: \"X\" }), void 0)] }), item.link || \"\"));\r\n                        }) }), void 0)] }), void 0), isOpenLightBox && (_jsx(Lightbox, { mainSrc: imageListLightBox[photoIndex], nextSrc: imageListLightBox[(photoIndex + 1) % imageListLightBox.length], prevSrc: imageListLightBox[(photoIndex + imageListLightBox.length - 1) %\r\n                    imageListLightBox.length], onCloseRequest: function () { return setIsOpenLightBox(false); }, onMovePrevRequest: function () {\r\n                    return setPhotoIndex((photoIndex + imageListLightBox.length - 1) %\r\n                        imageListLightBox.length);\r\n                }, onMoveNextRequest: function () {\r\n                    return setPhotoIndex((photoIndex + 1) % imageListLightBox.length);\r\n                } }, void 0))] }, void 0));\r\n};\r\n//# sourceMappingURL=ImageItem.js.map","references":["/Users/tuanbui/projects/client/propzy/clone_comment-category/node_modules/@types/react/index.d.ts","/Users/tuanbui/projects/client/propzy/clone_comment-category/node_modules/react-image-lightbox/index.d.ts","/Users/tuanbui/projects/client/propzy/clone_comment-category/node_modules/axios/index.d.ts","/Users/tuanbui/projects/client/propzy/clone_comment-category/src/constants/index.ts","/Users/tuanbui/projects/client/propzy/clone_comment-category/src/model/core-model/UtilModel.ts"],"map":"{\"version\":3,\"file\":\"ImageItem.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/components/ImageItem/ImageItem.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/tuanbui/projects/client/propzy/clone_comment-category/components/ImageItem/ImageItem.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"react\" />\r\nimport \"components/ImageItem/ImageItem.scss\";\r\nimport \"react-image-lightbox/style.css\";\r\ndeclare type ImageItemProp = {\r\n    categoryId: string | number;\r\n    showPhoto: boolean;\r\n    requiredTextInput: boolean;\r\n    onHandleChangeImage: Function;\r\n    categoryName: string;\r\n};\r\nexport declare const ImageItem: (props: ImageItemProp) => JSX.Element;\r\nexport {};\r\n"}}
